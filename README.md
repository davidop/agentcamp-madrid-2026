# CopilotAspireArchitectureGeneration

Sample code to show how to generate an architecture diagram from a .NET Aspire solution using different prompt approaches, combined with Python scraping and MCP Agents for a fully automated documentation pipeline.

<img width="2610" height="1672" alt="image" src="https://github.com/user-attachments/assets/4e0bae37-fe7d-4742-bbe0-934fab2cceda" />

## What this demo covers

This repository demonstrates the concepts presented at **AgentCamp Madrid 2026**:

- ğŸ”· **.NET Aspire** â€” microservices orchestration (AppHost, Web, ApiService, ServiceDefaults)
- ğŸ¤– **MCP Agents** â€” intelligent documentation enrichment via the `mcp-mermaid` and Playwright servers
- ğŸ **Python scraping** â€” controlled extraction of project and documentation information
- ğŸ“Š **Mermaid visualisation** â€” architecture diagrams, event flows, and pipeline charts

The full pipeline goes from **raw code** â†’ **scraped metadata** â†’ **AI-generated documentation with Mermaid diagrams**.

## Pipeline

```
scraper.py  â”€â”€â–º  extract_aspire_metadata  â”€â”€â–º  pipeline.py  â”€â”€â–º  docs/SolutionOverview-*.md
                                                    â”‚
                                             MCP Agent review
```

## Quick start

### 1. Run the documentation pipeline

```bash
python pipeline.py
```

This will:
1. Scan all source files under `src/`
2. Extract Aspire services, resources, and API endpoints
3. Generate `docs/SolutionOverview-<timestamp>.md` with:
   - Architecture diagram (Mermaid `graph TB`)
   - Event flow diagram (Mermaid `sequenceDiagram`)
   - Pipeline diagram (Mermaid `flowchart`)

Optional â€” also scrape a remote URL:

```bash
python pipeline.py --url https://learn.microsoft.com/en-us/dotnet/aspire/get-started/aspire-overview
```

### 2. Run only the scraper

```bash
python scraper.py
python scraper.py --url https://example.com/docs
```

### 3. Generate docs with Mermaid charts (original script)

```bash
python generate_mermaid_docs.py
```

### 4. Validate generated Mermaid syntax

```bash
python validate_mermaid.py
```

### 5. Launch the .NET Aspire solution

```bash
dotnet run --project src/AspireApp2.AppHost/AspireApp2.AppHost.csproj
```

## Development environment

A DevContainer is provided for a ready-to-use development environment:

- **Base image**: `mcr.microsoft.com/devcontainers/dotnet:9.0`
- **GitHub CLI** (`gh`) is pre-installed via the `ghcr.io/devcontainers/features/github-cli:1` feature
- **gh-aw extension** is installed automatically on container creation (`gh extension install github/gh-aw`)
- **VS Code extensions**: `ms-dotnettools.csharp`, `ms-dotnettools.vscode-dotnet-runtime`

Open the repo in VS Code and select **Reopen in Container** to get started.

## GitHub Agentic Workflows

The repository includes several [gh-aw](https://github.com/github/gh-aw) agentic workflows:

| Workflow | Schedule | Purpose |
|----------|----------|---------|
| `daily-repo-status` | Daily | Generates a GitHub issue with repository activity highlights, progress tracking, and recommendations |
| `daily-doc-updater` | Daily | Scans merged PRs and commits from the last 24 hours and creates a documentation PR for new or changed features |

Workflow source files are in `.github/workflows/` (`.md` files). Compiled lock files (`.lock.yml`) are generated by `gh aw compile` and should not be edited directly.

### Running workflows manually

```bash
gh workflow run daily-repo-status.lock.yml
gh workflow run daily-doc-updater.lock.yml
```

## MCP Agents

The `.github/agents/` directory contains custom Copilot agents:

| Agent | Description |
|-------|-------------|
| `agentic-workflows` | Dispatcher agent for creating, debugging, and upgrading gh-aw workflows |
| `mcp-azurefunction` | Adapter between Copilot Chat and Azure Function MCP tools for reading and searching PDFs in Azure Blob Storage |

### MCP Azure Function agent

The `mcp-azurefunction` agent supports two actions via `azurefunction:` prefixed messages:

| Action | Parameters | Description |
|--------|-----------|-------------|
| `get_pdf_text` | `fileName` | Retrieve full text from a PDF stored in Azure Blob Storage |
| `search_pdf` | `fileName`, `query` | Semantic search within a PDF |

Example usage in Copilot Chat:
```
azurefunction: get_pdf_text my-document.pdf
azurefunction: search_pdf my-document.pdf | what is the deployment strategy?
```

### Azurite (local Azure Storage emulator)

The `AzuriteConfig` file and `__azurite_db_*.json` files configure a local [Azurite](https://learn.microsoft.com/en-us/azure/storage/common/storage-use-azurite) instance for development and testing of the Azure Blob Storage integration.

## MCP Servers

The `src/.mcp.json` file configures the following MCP servers:

| Server | Purpose |
|--------|---------|
| `playwright` | Browser automation and screenshot capture |
| `mcp-mermaid` | Mermaid diagram rendering and validation |
| `hf-mcp-server` | Hugging Face model access (requires token) |

## Repository structure

```
â”œâ”€â”€ .devcontainer/              # DevContainer configuration
â”‚   â””â”€â”€ devcontainer.json
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ agents/                 # Custom Copilot agents
â”‚   â”‚   â”œâ”€â”€ agentic-workflows.agent.md
â”‚   â”‚   â””â”€â”€ mcp-azurefunction.agent.md
â”‚   â””â”€â”€ workflows/              # GitHub Actions & gh-aw workflows
â”‚       â”œâ”€â”€ daily-repo-status.md        # Agentic workflow source
â”‚       â”œâ”€â”€ daily-repo-status.lock.yml  # Compiled workflow
â”‚       â”œâ”€â”€ daily-doc-updater.md        # Agentic workflow source
â”‚       â””â”€â”€ daily-doc-updater.lock.yml  # Compiled workflow
â”œâ”€â”€ src/                        # .NET Aspire solution
â”‚   â”œâ”€â”€ AspireApp2.AppHost/     # Orchestrator
â”‚   â”œâ”€â”€ AspireApp2.Web/         # Blazor frontend
â”‚   â”œâ”€â”€ AspireApp2.ApiService/  # Weather API
â”‚   â”œâ”€â”€ AspireApp2.ServiceDefaults/
â”‚   â””â”€â”€ AspireApp2.Tests/
â”œâ”€â”€ docs/                       # Generated documentation
â”‚   â””â”€â”€ diagrams/               # Architecture diagram images
â”œâ”€â”€ scraper.py                  # Python scraping module
â”œâ”€â”€ pipeline.py                 # Documentation pipeline orchestrator
â”œâ”€â”€ generate_mermaid_docs.py    # Mermaid chart generation script
â”œâ”€â”€ validate_mermaid.py         # Mermaid syntax validator
â”œâ”€â”€ prompt-generatedoc.md       # Agent prompt (ASCII diagrams)
â””â”€â”€ prompt-generatedoc-mermaidcharts.md  # Agent prompt (Mermaid charts)
```


